#!/usr/bin/env bash
set -u

source bin/lib/helpers.sh

CPP_FILES=${@:-$(git ls-files --no-deleted *.cpp)}
HPP_FILES=${@:-$(git ls-files --no-deleted *.hpp)}

function lint_fix() {
  FILES=$1
  # xargs isn't playing nice and I'm not invested enough to solve that
  clang-tidy \
    --fix-errors \
    ${FILES} \
    -- -std=c++17 \
    -I ./include/ \
    -I ./vendor/ \
    -I ./vendor/raylib/include/ \
    -I ./vendor/mruby/
  }

log "Linting CPP files"
job_output=$(lint_fix ${CPP_FILES} 2>&1)
barf_if_failed $?

log "Linting HPP files"
job_output=$(lint_fix ${HPP_FILES} 2>&1)
barf_if_failed $?
