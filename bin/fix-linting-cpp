#!/usr/bin/env bash
set -u

source bin/lib/helpers.sh

XPP_FILES=${@:-$(git ls-files --no-deleted *.{cpp,hpp})}

function lint_fix() {
  file=$1
  clang-tidy \
    --fix-errors \
    ${file} \
    -- -std=c++17 \
    -I ./include/ \
    -I ./vendor/ \
    -I ./vendor/raylib/include/ \
    -I ./vendor/mruby/
  }

for file in ${XPP_FILES}; do
  log "Linting ${file}"
  job_output=$(lint_fix ${file} 2>&1)
  barf_if_failed $?
done
