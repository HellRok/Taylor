#!/usr/bin/env bash
set -euo pipefail

log() {
  echo "[ ${0} ]" "${@}"
}

set -euo pipefail

log "Setting up for headless tests"
export DISPLAY=:1
Xvfb :1 -screen 0 1280x800x24 &> /dev/null &
export XVFB_PID=$!

log XVFB_PID: $XVFB_PID
while [ ! -e /tmp/.X11-unix/X1 ]; do sleep 0.25; done

openbox &> /dev/null &
export OPENBOX_PID=$!
log OPENBOX_PID: $XVFB_PID

log "Cleaning up"

bundle exec rake clean
